/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/photo-sphere-viewer@4.6.1/dist/plugins/gyroscope.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/*!
* Photo Sphere Viewer 4.6.1
* @copyright 2014-2015 Jérémy Heleine
* @copyright 2015-2022 Damien "Mistic" Sorel
* @licence MIT (https://opensource.org/licenses/MIT)
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("photo-sphere-viewer")):"function"==typeof define&&define.amd?define(["exports","three","photo-sphere-viewer"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).PhotoSphereViewer=e.PhotoSphereViewer||{},e.PhotoSphereViewer.GyroscopePlugin={}),e.THREE,e.PhotoSphereViewer)}(this,(function(e,t,n){"use strict";function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},o.apply(this,arguments)}function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r(e,t)}function r(e,t){return r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(e,t)}var s={GYROSCOPE_UPDATED:"gyroscope-updated"},a=new t.Vector3(0,0,1),c=new t.Euler,l=new t.Quaternion,p=new t.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),u=function(e){!1===window.isSecureContext&&console.error("THREE.DeviceOrientationControls: DeviceOrientationEvent is only available in secure contexts (https)");var n=this,o=new t.Quaternion;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var i=function(e){n.deviceOrientation=e},r=function(){n.screenOrientation=window.orientation||0};this.connect=function(){r(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then((function(e){"granted"==e&&(window.addEventListener("orientationchange",r),window.addEventListener("deviceorientation",i))})).catch((function(e){console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)})):(window.addEventListener("orientationchange",r),window.addEventListener("deviceorientation",i)),n.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",r),window.removeEventListener("deviceorientation",i),n.enabled=!1},this.update=function(){if(!1!==n.enabled){var e=n.deviceOrientation;if(e){var i=e.alpha?t.MathUtils.degToRad(e.alpha)+n.alphaOffset:0,r=e.beta?t.MathUtils.degToRad(e.beta):0,s=e.gamma?t.MathUtils.degToRad(e.gamma):0,u=n.screenOrientation?t.MathUtils.degToRad(n.screenOrientation):0;!function(e,t,n,o,i){c.set(n,t,-o,"YXZ"),e.setFromEuler(c),e.multiply(p),e.multiply(l.setFromAxisAngle(a,-i))}(n.object.quaternion,i,r,s,u),8*(1-o.dot(n.object.quaternion))>1e-6&&o.copy(n.object.quaternion)}}},this.dispose=function(){n.disconnect()},this.connect()},h=function(e){function t(t){var n;return(n=e.call(this,t,"psv-button--hover-scale psv-gyroscope-button",!0)||this).plugin=n.psv.getPlugin("gyroscope"),n.plugin&&n.plugin.on(s.GYROSCOPE_UPDATED,function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)),n}i(t,e);var n=t.prototype;return n.destroy=function(){this.plugin&&this.plugin.off(s.GYROSCOPE_UPDATED,this),delete this.plugin,e.prototype.destroy.call(this)},n.isSupported=function(){return!!this.plugin&&{initial:!1,promise:this.plugin.prop.isSupported}},n.handleEvent=function(e){e.type===s.GYROSCOPE_UPDATED&&this.toggleActive(e.args[0])},n.onClick=function(){this.plugin.toggle()},t}(n.AbstractButton);h.id="gyroscope",h.icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="currentColor" d="M50 0a50 50 0 1 0 0 100A50 50 0 0 0 50 0zm0 88.81a38.86 38.86 0 0 1-38.81-38.8 38.86 38.86 0 0 1 38.8-38.82A38.86 38.86 0 0 1 88.82 50 38.87 38.87 0 0 1 50 88.81z"/><path fill="currentColor" d="M72.07 25.9L40.25 41.06 27.92 74.12l31.82-15.18v-.01l12.32-33.03zM57.84 54.4L44.9 42.58l21.1-10.06-8.17 21.9z"/>\x3c!--Created by iconoci from the Noun Project--\x3e</svg>\n',n.DEFAULTS.lang[h.id]="Gyroscope",n.registerButton(h,"caption:right");var d=new t.Vector3,f=function(e){function r(t,n){var i;return(i=e.call(this,t)||this).prop={isSupported:i.__checkSupport(),alphaOffset:0,enabled:!1,config_moveInertia:!0},i.config=o({touchmove:!0,absolutePosition:!1},n),i.controls=null,i}i(r,e);var a=r.prototype;return a.init=function(){e.prototype.init.call(this),this.psv.on(n.CONSTANTS.EVENTS.STOP_ALL,this),this.psv.on(n.CONSTANTS.EVENTS.BEFORE_ROTATE,this),this.psv.on(n.CONSTANTS.EVENTS.BEFORE_RENDER,this)},a.destroy=function(){this.psv.off(n.CONSTANTS.EVENTS.STOP_ALL,this),this.psv.off(n.CONSTANTS.EVENTS.BEFORE_ROTATE,this),this.psv.off(n.CONSTANTS.EVENTS.BEFORE_RENDER,this),this.stop(),delete this.controls,e.prototype.destroy.call(this)},a.handleEvent=function(e){switch(e.type){case n.CONSTANTS.EVENTS.STOP_ALL:this.stop();break;case n.CONSTANTS.EVENTS.BEFORE_RENDER:this.__onBeforeRender();break;case n.CONSTANTS.EVENTS.BEFORE_ROTATE:this.__onBeforeRotate(e)}},a.isEnabled=function(){return this.prop.enabled},a.start=function(){var e=this;return this.prop.isSupported.then((function(t){return t?e.__requestPermission():(n.utils.logWarn("gyroscope not available"),Promise.reject())})).then((function(e){return e?Promise.resolve():(n.utils.logWarn("gyroscope not allowed"),Promise.reject())})).then((function(){e.psv.__stopAll(),e.prop.config_moveInertia=e.psv.config.moveInertia,e.psv.config.moveInertia=!1,e.controls?e.controls.connect():e.controls=new u(new t.Object3D),e.controls.deviceOrientation=null,e.controls.screenOrientation=0,e.controls.alphaOffset=0,e.prop.alphaOffset=e.config.absolutePosition?0:null,e.prop.enabled=!0,e.trigger(s.GYROSCOPE_UPDATED,!0)}))},a.stop=function(){this.isEnabled()&&(this.controls.disconnect(),this.prop.enabled=!1,this.psv.config.moveInertia=this.prop.config_moveInertia,this.trigger(s.GYROSCOPE_UPDATED,!1))},a.toggle=function(){this.isEnabled()?this.stop():this.start()},a.__onBeforeRender=function(){if(this.isEnabled()&&this.controls.deviceOrientation){var e=this.psv.getPosition();if(null===this.prop.alphaOffset){this.controls.update(),this.controls.object.getWorldDirection(d);var t=this.psv.dataHelper.vector3ToSphericalCoords(d);this.prop.alphaOffset=t.longitude-e.longitude}else{this.controls.alphaOffset=this.prop.alphaOffset,this.controls.update(),this.controls.object.getWorldDirection(d);var o=this.psv.dataHelper.vector3ToSphericalCoords(d),i={longitude:o.longitude,latitude:-o.latitude};this.psv.dynamics.position.goto(i,n.utils.getAngle(e,i)<.01?1:3)}}},a.__onBeforeRotate=function(e){this.isEnabled()&&(e.preventDefault(),this.config.touchmove&&(this.prop.alphaOffset-=e.args[0].longitude-this.psv.getPosition().longitude))},a.__checkSupport=function(){return"DeviceMotionEvent"in window&&"function"==typeof DeviceMotionEvent.requestPermission?Promise.resolve(!0):"DeviceOrientationEvent"in window?new Promise((function(e){var t=function t(n){e(n&&null!==n.alpha&&!isNaN(n.alpha)),window.removeEventListener("deviceorientation",t)};window.addEventListener("deviceorientation",t,!1),setTimeout(t,2e3)})):Promise.resolve(!1)},a.__requestPermission=function(){return"DeviceMotionEvent"in window&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(e){return"granted"===e})).catch((function(){return!1})):Promise.resolve(!0)},r}(n.AbstractPlugin);f.id="gyroscope",f.EVENTS=s,e.EVENTS=s,e.GyroscopePlugin=f,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=/sm/2194befe7baacdc2c7303cf1c31939c85a0ff0d590239e996eb9e8782488d1c3.map