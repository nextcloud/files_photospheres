/**
 * Minified by jsDelivr using Terser v5.17.1.
 * Original file: /npm/@photo-sphere-viewer/gyroscope-plugin@5.1.6/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("@photo-sphere-viewer/core")):"function"==typeof define&&define.amd?define(["exports","three","@photo-sphere-viewer/core"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).PhotoSphereViewer=e.PhotoSphereViewer||{},e.PhotoSphereViewer.GyroscopePlugin={}),e.THREE,e.PhotoSphereViewer)}(this,(function(e,t,i){
/*!
 * PhotoSphereViewer.GyroscopePlugin 5.1.6
 * @copyright 2023 Damien "Mistic" Sorel
 * @licence MIT (https://opensource.org/licenses/MIT)
 */
"use strict";var o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,a=(e,t)=>{for(var i in t)o(e,i,{get:t[i],enumerable:!0})},c=()=>i,h=()=>t,l={};a(l,{GyroscopePlugin:()=>D,events:()=>p});var d=c(),v=c(),p={};a(p,{GyroscopeUpdatedEvent:()=>g});var u=c(),f=class extends u.TypedEvent{constructor(e){super(f.type),this.gyroscopeEnabled=e}},g=f;g.type="gyroscope-updated";var w=class extends v.AbstractButton{constructor(e){super(e,{className:"psv-gyroscope-button",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="currentColor" d="M50 0a50 50 0 1 0 0 100A50 50 0 0 0 50 0zm0 88.81a38.86 38.86 0 0 1-38.81-38.8 38.86 38.86 0 0 1 38.8-38.82A38.86 38.86 0 0 1 88.82 50 38.87 38.87 0 0 1 50 88.81z"/><path fill="currentColor" d="M72.07 25.9L40.25 41.06 27.92 74.12l31.82-15.18v-.01l12.32-33.03zM57.84 54.4L44.9 42.58l21.1-10.06-8.17 21.9z"/>\x3c!--Created by iconoci from the Noun Project--\x3e</svg>',hoverScale:!0,collapsable:!0,tabbable:!0}),this.plugin=this.viewer.getPlugin("gyroscope"),this.plugin&&this.plugin.addEventListener(g.type,this)}destroy(){this.plugin&&this.plugin.removeEventListener(g.type,this),super.destroy()}isSupported(){return!!this.plugin&&{initial:!1,promise:this.plugin.isSupported()}}handleEvent(e){e instanceof g&&this.toggleActive(e.gyroscopeEnabled)}onClick(){this.plugin.toggle()}};w.id="gyroscope";var m=c(),E=h(),y=h(),b=new y.Vector3(0,0,1),O=new y.Euler,P=new y.Quaternion,_=new y.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),S=m.utils.getConfigParser({touchmove:!0,absolutePosition:!1,moveMode:"smooth"},{moveMode:(e,{defValue:t})=>"smooth"!==e&&"fast"!==e?(m.utils.logWarn("GyroscopePlugin: invalid moveMode"),t):e}),L=new E.Vector3,D=class extends m.AbstractConfigurablePlugin{constructor(e,t){super(e,t),this.state={isSupported:this.__checkSupport(),alphaOffset:0,enabled:!1,config_moveInertia:!0,moveMode:this.config.moveMode}}init(){super.init(),this.viewer.addEventListener(m.events.StopAllEvent.type,this),this.viewer.addEventListener(m.events.BeforeRotateEvent.type,this),this.viewer.addEventListener(m.events.BeforeRenderEvent.type,this)}destroy(){this.viewer.removeEventListener(m.events.StopAllEvent.type,this),this.viewer.removeEventListener(m.events.BeforeRotateEvent.type,this),this.viewer.removeEventListener(m.events.BeforeRenderEvent.type,this),this.stop(),delete this.controls,super.destroy()}handleEvent(e){e instanceof m.events.StopAllEvent?this.stop():e instanceof m.events.BeforeRenderEvent?this.__onBeforeRender():e instanceof m.events.BeforeRotateEvent&&this.__onBeforeRotate(e)}isSupported(){return this.state.isSupported}isEnabled(){return this.state.enabled}start(e=this.config.moveMode){return this.state.isSupported.then((e=>e?this.__requestPermission():(m.utils.logWarn("gyroscope not available"),Promise.reject()))).then((e=>e?Promise.resolve():(m.utils.logWarn("gyroscope not allowed"),Promise.reject()))).then((()=>{this.viewer.stopAll(),this.state.moveMode=e,this.state.config_moveInertia=this.viewer.config.moveInertia,this.viewer.config.moveInertia=!1,this.controls?this.controls.connect():this.controls=new class{constructor(e){!1===window.isSecureContext&&console.error("THREE.DeviceOrientationControls: DeviceOrientationEvent is only available in secure contexts (https)");const t=this,i=new y.Quaternion;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;const o=function(e){t.deviceOrientation=e},n=function(){t.screenOrientation=window.orientation||0};this.connect=function(){n(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then((function(e){"granted"==e&&(window.addEventListener("orientationchange",n),window.addEventListener("deviceorientation",o))})).catch((function(e){console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)})):(window.addEventListener("orientationchange",n),window.addEventListener("deviceorientation",o)),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",n),window.removeEventListener("deviceorientation",o),t.enabled=!1},this.update=function(){if(!1===t.enabled)return;const e=t.deviceOrientation;if(e){const o=e.alpha?y.MathUtils.degToRad(e.alpha)+t.alphaOffset:0,n=e.beta?y.MathUtils.degToRad(e.beta):0,s=e.gamma?y.MathUtils.degToRad(e.gamma):0,r=t.screenOrientation?y.MathUtils.degToRad(t.screenOrientation):0;!function(e,t,i,o,n){O.set(i,t,-o,"YXZ"),e.setFromEuler(O),e.multiply(_),e.multiply(P.setFromAxisAngle(b,-n))}(t.object.quaternion,o,n,s,r),8*(1-i.dot(t.object.quaternion))>1e-6&&i.copy(t.object.quaternion)}},this.dispose=function(){t.disconnect()},this.connect()}}(new E.Object3D),this.controls.deviceOrientation=null,this.controls.screenOrientation=0,this.controls.alphaOffset=0,this.state.alphaOffset=this.config.absolutePosition?0:null,this.state.enabled=!0,this.dispatchEvent(new g(!0))}))}stop(){this.isEnabled()&&(this.controls.disconnect(),this.state.enabled=!1,this.viewer.config.moveInertia=this.state.config_moveInertia,this.dispatchEvent(new g(!1)),this.viewer.resetIdleTimer())}toggle(){this.isEnabled()?this.stop():this.start()}__onBeforeRender(){if(!this.isEnabled())return;if(!this.controls.deviceOrientation)return;const e=this.viewer.getPosition();if(null===this.state.alphaOffset){this.controls.update(),this.controls.object.getWorldDirection(L);const t=this.viewer.dataHelper.vector3ToSphericalCoords(L);this.state.alphaOffset=t.yaw-e.yaw}else{this.controls.alphaOffset=this.state.alphaOffset,this.controls.update(),this.controls.object.getWorldDirection(L);const t=this.viewer.dataHelper.vector3ToSphericalCoords(L),i={yaw:t.yaw,pitch:-t.pitch},o="smooth"===this.state.moveMode?3:10;this.viewer.dynamics.position.goto(i,m.utils.getAngle(e,i)<.01?1:o)}}__onBeforeRotate(e){this.isEnabled()&&(e.preventDefault(),this.config.touchmove&&(this.state.alphaOffset-=e.position.yaw-this.viewer.getPosition().pitch))}__checkSupport(){return"DeviceOrientationEvent"in window&&"function"==typeof DeviceOrientationEvent.requestPermission?Promise.resolve(!0):"DeviceOrientationEvent"in window?new Promise((e=>{const t=i=>{e(!!i&&!m.utils.isNil(i.alpha)&&!isNaN(i.alpha)),window.removeEventListener("deviceorientation",t)};window.addEventListener("deviceorientation",t,!1),setTimeout(t,1e4)})):Promise.resolve(!1)}__requestPermission(){return"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>"granted"===e)).catch((()=>!1)):Promise.resolve(!0)}};D.id="gyroscope",D.configParser=S,d.DEFAULTS.lang[w.id]="Gyroscope",(0,d.registerButton)(w,"caption:right"),((e,t,i,a)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let c of s(t))r.call(e,c)||c===i||o(e,c,{get:()=>t[c],enumerable:!(a=n(t,c))||a.enumerable})})(o(e,"__esModule",{value:!0}),l)}));
//# sourceMappingURL=/sm/4196b73add76b77d99b4e32d4742131ead72783c9f6402b68ddebe7f5b6062be.map